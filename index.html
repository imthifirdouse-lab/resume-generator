<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Resume Builder (Autofill Enabled)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #2c3e50; --accent: #3498db; --bg: #f4f7f6; --text: #333; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; height: 100vh; display: flex; overflow: hidden; }

        /* --- LAYOUT --- */
        .app-container { display: flex; width: 100%; height: 100%; }
        
        /* LEFT: EDITOR */
        .editor-pane { width: 45%; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; z-index: 10; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        .editor-header { padding: 20px; background: #fff; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .editor-content { flex: 1; overflow-y: auto; padding: 30px; }
        .editor-footer { padding: 20px; border-top: 1px solid #eee; background: #f9f9f9; display: flex; gap: 10px; }

        /* RIGHT: PREVIEW */
        .preview-pane { width: 55%; background: #525659; display: flex; justify-content: center; align-items: flex-start; overflow-y: auto; padding: 40px; }
        .resume-paper { background: white; width: 210mm; min-height: 297mm; padding: 0; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: row; color: #333; }

        /* --- FORM STYLING --- */
        h2 { font-size: 18px; color: var(--primary); margin-top: 30px; border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; font-size: 12px; font-weight: 700; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 13px; box-sizing: border-box; transition: 0.2s; }
        input:focus, textarea:focus { border-color: var(--accent); outline: none; }
        textarea { resize: vertical; min-height: 80px; }
        
        .btn-add { background: #eef2f5; color: var(--primary); border: 1px dashed #bdc3c7; padding: 10px; width: 100%; cursor: pointer; border-radius: 4px; font-weight: 600; margin-top: 10px; }
        .btn-delete { color: #e74c3c; cursor: pointer; font-size: 12px; text-decoration: underline; margin-top: 5px; display: inline-block; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 12px 24px; border-radius: 4px; font-weight: bold; cursor: pointer; flex: 1; text-align: center; }
        
        /* SUGGESTION MODAL */
        .suggestion-btn { background: #e8f4fd; color: #3498db; border: none; padding: 5px 10px; border-radius: 20px; font-size: 11px; cursor: pointer; margin-bottom: 5px; display: inline-flex; align-items: center; gap: 5px; font-weight: 600; transition: 0.2s; }
        .suggestion-btn:hover { background: #3498db; color: white; }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 500px; max-height: 80vh; border-radius: 8px; padding: 20px; display: flex; flex-direction: column; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .modal-header { font-weight: bold; font-size: 16px; margin-bottom: 15px; display: flex; justify-content: space-between; }
        .modal-list { overflow-y: auto; flex: 1; }
        .suggestion-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 13px; color: #444; transition: 0.2s; display: flex; gap: 10px; align-items: flex-start; }
        .suggestion-item:hover { background: #f0f7ff; color: #3498db; }
        .suggestion-item i { margin-top: 3px; color: #27ae60; }
        .modal-close { cursor: pointer; color: #999; }

        /* --- PREVIEW STYLING --- */
        #preview-sidebar { width: 32%; background: var(--primary); color: white; padding: 20px; }
        #preview-main { width: 68%; padding: 30px; background: white; }
        
        .p-name { font-size: 24px; font-weight: 700; text-transform: uppercase; line-height: 1.2; }
        .p-title { font-size: 14px; color: var(--accent); font-weight: 600; margin-bottom: 20px; text-transform: uppercase; }
        .p-section-title { font-size: 12px; font-weight: 700; color: var(--accent); border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; margin-top: 20px; letter-spacing: 1px; }
        
        .p-side-header { font-size: 12px; font-weight: 700; color: var(--accent); margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px; }
        .p-contact-item { font-size: 10px; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; opacity: 0.9; }
        .p-skill-item { font-size: 10px; background: rgba(255,255,255,0.1); padding: 3px 8px; margin-bottom: 4px; display: inline-block; border-radius: 3px; }
        
        .p-job-block { margin-bottom: 15px; }
        .p-job-title { font-weight: 700; font-size: 13px; color: #2c3e50; }
        .p-job-company { font-style: italic; color: #7f8c8d; font-size: 11px; margin-bottom: 5px; }
        .p-job-desc { font-size: 11px; color: #444; line-height: 1.5; white-space: pre-wrap; }
        .p-initials { width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; margin: 0 auto 20px; border: 2px solid rgba(255,255,255,0.2); }
    </style>
</head>
<body>

<div class="modal-overlay" id="suggestionModal">
    <div class="modal-box">
        <div class="modal-header">
            <span>✨ Smart Suggestions</span>
            <span class="modal-close" onclick="closeModal()">✕</span>
        </div>
        <div style="font-size:12px; color:#666; margin-bottom:10px;" id="suggestionContext">Showing suggestions for: <b>Software Engineer</b></div>
        <div class="modal-list" id="suggestionList">
            </div>
    </div>
</div>

<div class="app-container">
    <div class="editor-pane">
        <div class="editor-header">
            <span style="font-weight:700; color: var(--primary);"><i class="fas fa-magic"></i> Resume Builder + AI Suggestions</span>
            <input type="color" id="themeColor" value="#3498db" onchange="updateTheme(this.value)" style="width:50px; padding:2px; height:30px;">
        </div>
        
        <div class="editor-content">
            <h2><i class="fas fa-user-circle"></i> Personal Details</h2>
            <div class="form-group"><label>Full Name</label><input type="text" id="inputName" placeholder="Imtheyas F.M" oninput="updatePreview()"></div>
            <div class="form-group"><label>Target Job Title</label><input type="text" id="inputTitle" placeholder="Senior Technical Lead" oninput="updatePreview()"></div>
            <div class="form-group">
                <label>Contact Info</label>
                <input type="text" id="inputPhone" placeholder="Phone" oninput="updatePreview()">
                <input type="text" id="inputEmail" placeholder="Email" style="margin-top:5px" oninput="updatePreview()">
                <input type="text" id="inputLocation" placeholder="Location" style="margin-top:5px" oninput="updatePreview()">
            </div>

            <h2><i class="fas fa-align-left"></i> Profile Summary</h2>
            <div class="form-group">
                <textarea id="inputSummary" placeholder="Write a compelling summary..." oninput="updatePreview()">Senior Technical Lead with 4+ years of expertise in Legacy Modernization...</textarea>
            </div>

            <h2><i class="fas fa-briefcase"></i> Experience</h2>
            <div id="experience-container"></div>
            <button class="btn-add" onclick="addExperienceField()">+ Add Position</button>

            <h2><i class="fas fa-tools"></i> Skills</h2>
            <div class="form-group">
                <textarea id="inputSkills" rows="5" oninput="updatePreview()">Perl (Modern)&#10;DMN Architecture&#10;Agile / Scrum</textarea>
            </div>

            <h2><i class="fas fa-graduation-cap"></i> Education</h2>
            <div class="form-group"><textarea id="inputEducation" rows="3" oninput="updatePreview()">B.E. ECE (2019)&#10;Sri Eshwar College</textarea></div>
        </div>

        <div class="editor-footer">
            <button class="btn-primary" onclick="generatePDF()"><i class="fas fa-file-download"></i> Download PDF</button>
        </div>
    </div>

    <div class="preview-pane">
        <div class="resume-paper" id="resumePreview">
            <div id="preview-sidebar">
                <div class="p-initials" id="pInitials">IM</div>
                <div class="p-side-header">CONTACT</div>
                <div class="p-contact-item"><i class="fas fa-phone"></i> <span id="pPhone"></span></div>
                <div class="p-contact-item"><i class="fas fa-envelope"></i> <span id="pEmail"></span></div>
                <div class="p-contact-item"><i class="fas fa-map-marker-alt"></i> <span id="pLocation"></span></div>
                <br>
                <div class="p-side-header">SKILLS</div>
                <div id="pSkills"></div>
                <br>
                <div class="p-side-header">EDUCATION</div>
                <div id="pEducation" style="font-size:10px; line-height:1.4"></div>
            </div>

            <div id="preview-main">
                <div class="p-name" id="pName">IMTHEYAS F.M</div>
                <div class="p-title" id="pTitle">SENIOR TECHNICAL LEAD</div>
                <div class="p-section-title">PROFESSIONAL SUMMARY</div>
                <div class="p-job-desc" id="pSummary"></div>
                <div class="p-section-title">WORK HISTORY</div>
                <div id="pExperienceList"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- DATABASE OF SUGGESTIONS ---
    const suggestionsDB = {
        "lead": [
            "Orchestrated sprint planning, backlog grooming, and daily stand-ups for a team of X developers.",
            "Mentored junior engineers, conducting code reviews and enforcing best practices.",
            "Reduced technical debt by X% through strategic refactoring of legacy codebases.",
            "Collaborated with Product Owners to translate business requirements into technical specs.",
            "Spearheaded the migration from Monolithic architecture to Microservices."
        ],
        "software": [
            "Developed scalable backend APIs using [Language], improving system throughput by X%.",
            "Optimized SQL queries reducing data retrieval latency by X%.",
            "Implemented CI/CD pipelines using Jenkins/GitLab to automate deployment.",
            "Resolved critical production bugs under tight SLAs, ensuring 99.9% uptime.",
            "Wrote comprehensive unit and integration tests achieving X% code coverage."
        ],
        "legacy": [
            "Migrated complex business logic from Legacy Perl scripts to modern Rule Engines (DMN).",
            "Refactored unmaintained codebase to improve security and readability.",
            "Decoupled hardcoded logic into configurable parameters, increasing system flexibility.",
            "Documented legacy workflows to facilitate knowledge transfer and onboarding."
        ],
        "data": [
            "Engineered ETL pipelines to ingest terabytes of data from various sources.",
            "Automated manual data reporting tasks, saving X hours of operational time weekly.",
            "Designed data integration workflows ensuring data integrity and consistency."
        ]
    };

    let experiences = [
        { title: "Team Lead", company: "GAVS Technologies", dates: "09/2022 - Present", desc: "Orchestrated migration of legacy business logic from Perl to DMN.\nFacilitated Scrum ceremonies." },
        { title: "Software Engineer", company: "RR Donnelly", dates: "04/2021 - 09/2022", desc: "Engineered Perl-based data integration solutions.\nResolved critical production issues." }
    ];

    let activeExpIndex = null;

    window.onload = function() {
        if(localStorage.getItem('resumeData')) loadData();
        else renderExperienceInputs();
        updatePreview();
    };

    // --- SUGGESTION LOGIC ---
    function openSuggestions(index) {
        activeExpIndex = index;
        const jobTitle = experiences[index].title.toLowerCase();
        const modal = document.getElementById('suggestionModal');
        const list = document.getElementById('suggestionList');
        const contextText = document.getElementById('suggestionContext');
        
        list.innerHTML = "";
        let matches = [];

        // Simple Keyword Matching
        if(jobTitle.includes('lead') || jobTitle.includes('manager')) matches = [...matches, ...suggestionsDB.lead];
        if(jobTitle.includes('engineer') || jobTitle.includes('developer')) matches = [...matches, ...suggestionsDB.software];
        if(jobTitle.includes('legacy') || jobTitle.includes('perl') || jobTitle.includes('migration')) matches = [...matches, ...suggestionsDB.legacy];
        if(jobTitle.includes('data')) matches = [...matches, ...suggestionsDB.data];
        
        // Default fallback if no keywords match
        if(matches.length === 0) matches = [...suggestionsDB.software, ...suggestionsDB.lead];

        contextText.innerHTML = `Suggestions based on: <b>${experiences[index].title || "General Role"}</b>`;

        matches.forEach(text => {
            const item = document.createElement('div');
            item.className = 'suggestion-item';
            item.innerHTML = `<i class="fas fa-plus-circle"></i> <span>${text}</span>`;
            item.onclick = () => addSuggestion(text);
            list.appendChild(item);
        });

        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('suggestionModal').style.display = 'none';
    }

    function addSuggestion(text) {
        const currentDesc = experiences[activeExpIndex].desc;
        const separator = currentDesc.length > 0 ? '\n' : '';
        experiences[activeExpIndex].desc = currentDesc + separator + "• " + text;
        renderExperienceInputs(); // Re-render to show new text
        updatePreview();
        closeModal();
    }

    // --- CORE LOGIC ---
    function addExperienceField() {
        experiences.push({ title: "", company: "", dates: "", desc: "" });
        renderExperienceInputs();
        updatePreview();
    }

    function removeExperience(index) {
        experiences.splice(index, 1);
        renderExperienceInputs();
        updatePreview();
    }

    function updateExperienceData(index, field, value) {
        experiences[index][field] = value;
        updatePreview();
    }

    function renderExperienceInputs() {
        const container = document.getElementById('experience-container');
        container.innerHTML = "";
        
        experiences.forEach((exp, index) => {
            const div = document.createElement('div');
            div.className = 'form-group';
            div.style.background = "#f8f9fa";
            div.style.padding = "15px";
            div.style.border = "1px solid #eee";
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <label>Position ${index + 1}</label>
                    <button class="suggestion-btn" onclick="openSuggestions(${index})"><i class="fas fa-magic"></i> Autofill</button>
                </div>
                <input type="text" placeholder="Job Title" value="${exp.title}" oninput="updateExperienceData(${index}, 'title', this.value)" style="margin-bottom:5px">
                <input type="text" placeholder="Company" value="${exp.company}" oninput="updateExperienceData(${index}, 'company', this.value)" style="margin-bottom:5px">
                <input type="text" placeholder="Dates" value="${exp.dates}" oninput="updateExperienceData(${index}, 'dates', this.value)" style="margin-bottom:5px">
                <textarea placeholder="Achievements..." oninput="updateExperienceData(${index}, 'desc', this.value)">${exp.desc}</textarea>
                <span class="btn-delete" onclick="removeExperience(${index})">Remove Position</span>
            `;
            container.appendChild(div);
        });
    }

    function updatePreview() {
        const name = document.getElementById('inputName').value || "YOUR NAME";
        document.getElementById('pName').innerText = name;
        document.getElementById('pInitials').innerText = name.substring(0,2).toUpperCase();
        
        document.getElementById('pTitle').innerText = document.getElementById('inputTitle').value || "ROLE";
        document.getElementById('pPhone').innerText = document.getElementById('inputPhone').value;
        document.getElementById('pEmail').innerText = document.getElementById('inputEmail').value;
        document.getElementById('pLocation').innerText = document.getElementById('inputLocation').value;
        document.getElementById('pSummary').innerText = document.getElementById('inputSummary').value;
        document.getElementById('pEducation').innerText = document.getElementById('inputEducation').value;

        const skillsRaw = document.getElementById('inputSkills').value;
        document.getElementById('pSkills').innerHTML = skillsRaw.split('\n').filter(s=>s).map(s => `<div class="p-skill-item">${s}</div>`).join('');

        document.getElementById('pExperienceList').innerHTML = experiences.map(exp => `
            <div class="p-job-block">
                <div class="p-job-title">${exp.title}</div>
                <div class="p-job-company">${exp.company} | ${exp.dates}</div>
                <div class="p-job-desc">${exp.desc}</div>
            </div>
        `).join('');

        saveData();
    }

    function updateTheme(color) {
        document.documentElement.style.setProperty('--accent', color);
    }

    function saveData() {
        const data = {
            name: document.getElementById('inputName').value,
            title: document.getElementById('inputTitle').value,
            phone: document.getElementById('inputPhone').value,
            email: document.getElementById('inputEmail').value,
            location: document.getElementById('inputLocation').value,
            summary: document.getElementById('inputSummary').value,
            skills: document.getElementById('inputSkills').value,
            education: document.getElementById('inputEducation').value,
            experiences: experiences
        };
        localStorage.setItem('resumeData', JSON.stringify(data));
    }

    function loadData() {
        const data = JSON.parse(localStorage.getItem('resumeData'));
        if(!data) return;
        document.getElementById('inputName').value = data.name || "";
        document.getElementById('inputTitle').value = data.title || "";
        document.getElementById('inputPhone').value = data.phone || "";
        document.getElementById('inputEmail').value = data.email || "";
        document.getElementById('inputLocation').value = data.location || "";
        document.getElementById('inputSummary').value = data.summary || "";
        document.getElementById('inputSkills').value = data.skills || "";
        document.getElementById('inputEducation').value = data.education || "";
        if(data.experiences) experiences = data.experiences;
        renderExperienceInputs();
    }

    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const themeColorHex = document.getElementById('themeColor').value;
        const r = parseInt(themeColorHex.substr(1,2), 16);
        const g = parseInt(themeColorHex.substr(3,2), 16);
        const b = parseInt(themeColorHex.substr(5,2), 16);
        
        // PDF Gen Logic (Same as before)
        const sidebarColor = [44, 62, 80];
        doc.setFillColor(...sidebarColor);
        doc.rect(0, 0, 70, 297, 'F');
        
        let y = 30;
        doc.setFillColor(255,255,255); doc.circle(35, 30, 15, 'S');
        doc.setFontSize(16); doc.setTextColor(255,255,255);
        doc.text((document.getElementById('inputName').value||"XX").substring(0,2).toUpperCase(), 31, 32);

        y = 60;
        doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(r,g,b);
        doc.text("CONTACT", 10, y); y+=6;
        doc.setFontSize(9); doc.setFont("helvetica", "normal"); doc.setTextColor(230,230,230);
        [document.getElementById('inputPhone').value, document.getElementById('inputEmail').value, document.getElementById('inputLocation').value].forEach(l => { if(l) { doc.text(l, 10, y); y+=6; }});
        
        y+=10;
        doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(r,g,b); doc.text("SKILLS", 10, y); y+=6;
        doc.setFontSize(9); doc.setFont("helvetica", "normal"); doc.setTextColor(230,230,230);
        document.getElementById('inputSkills').value.split('\n').forEach(s => { if(s) { doc.text("• "+s, 10, y); y+=5; }});

        y=25; const x=80; const w=115;
        doc.setFontSize(24); doc.setFont("helvetica", "bold"); doc.setTextColor(44,62,80);
        doc.text(document.getElementById('inputName').value.toUpperCase(), x, y); y+=7;
        doc.setFontSize(12); doc.setTextColor(r,g,b);
        doc.text(document.getElementById('inputTitle').value.toUpperCase(), x, y); y+=5;
        doc.setDrawColor(200,200,200); doc.line(x,y,200,y); y+=10;

        // Content
        const sections = [
            { title: "PROFESSIONAL SUMMARY", text: document.getElementById('inputSummary').value },
            { title: "WORK HISTORY", items: experiences }
        ];

        doc.setFontSize(10); doc.setTextColor(60,60,60);
        const sumLines = doc.splitTextToSize(document.getElementById('inputSummary').value, w);
        doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(44,62,80);
        doc.text("PROFESSIONAL SUMMARY", x, y); y+=5;
        doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.setTextColor(60,60,60);
        doc.text(sumLines, x, y); y += (sumLines.length*5)+5;

        doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(44,62,80);
        doc.text("WORK HISTORY", x, y); y+=5;
        
        experiences.forEach(exp => {
            if(y>270) { doc.addPage(); doc.setFillColor(...sidebarColor); doc.rect(0,0,70,297,'F'); y=20; }
            doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(0,0,0);
            doc.text(exp.title, x, y); y+=5;
            doc.setFontSize(10); doc.setFont("helvetica", "italic"); doc.setTextColor(100,100,100);
            doc.text(`${exp.company} | ${exp.dates}`, x, y); y+=5;
            doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.setTextColor(60,60,60);
            const dLines = doc.splitTextToSize(exp.desc, w);
            doc.text(dLines, x, y); y+=(dLines.length*5)+6;
        });

        doc.save("Smart_Resume.pdf");
    }
</script>
</body>
</html>
